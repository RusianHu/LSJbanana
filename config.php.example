<?php

// 配置文件
// 存储敏感信息和全局配置

// ============================================================
// 用户系统与支付配置
// ============================================================

// 数据库配置 (SQLite)
$databaseConfig = [
    'driver' => 'sqlite',
    'path' => __DIR__ . '/database/lsjbanana.db',  // SQLite 数据库文件路径
];

// 支付配置 (老司机聚合支付)
$paymentConfig = [
    'enabled' => true,                                      // 是否启用支付功能
    'gateway_url' => 'https://pay.yanshanlaosiji.top',      // 支付网关地址
    'pid' => 1000,                                          // 商户ID (请替换为您的商户ID)
    'key' => 'your-merchant-key',                           // 商户MD5密钥 (请替换为您的密钥)
    'notify_url' => '',                                     // 异步通知地址 (留空则自动生成)
    'return_url' => '',                                     // 同步跳转地址 (留空则自动生成)
    'default_pay_type' => '',                               // 默认支付方式 (空则跳转收银台)
];

// 计费配置
$billingConfig = [
    'price_per_image' => 0.20,                              // 每张图片价格 (RMB)
    'min_recharge' => 1.00,                                 // 最低充值金额 (RMB)
    'max_recharge' => 1000.00,                              // 最高充值金额 (RMB)
    'recharge_options' => [5, 10, 20, 50, 100],             // 快捷充值选项 (RMB)
    'free_quota' => 0,                                      // 新用户免费额度 (张)
];

// 用户系统配置
$userConfig = [
    'enable_registration' => true,                          // 是否开放注册
    'enable_email_verification' => false,                   // 是否需要邮箱验证 (暂不实现)
    'session_lifetime' => 7 * 24 * 3600,                    // 会话有效期 (秒，默认7天)
    'remember_me_lifetime' => 30 * 24 * 3600,               // "记住我"有效期 (秒，默认30天)
    'password_min_length' => 6,                             // 密码最小长度
    'username_min_length' => 3,                             // 用户名最小长度
    'username_max_length' => 20,                            // 用户名最大长度
    'max_login_attempts' => 5,                              // 最大登录尝试次数
    'lockout_duration' => 15 * 60,                          // 锁定时长 (秒)
];

// 验证码配置
$captchaConfig = [
    'enable_login' => false,                                // 是否在登录时启用验证码
    'enable_register' => true,                              // 是否在注册时启用验证码
    'width' => 120,                                         // 验证码图片宽度
    'height' => 40,                                         // 验证码图片高度
    'font_size' => 18,                                      // 字体大小
    'chars' => '23456789ABCDEFGHJKLMNPQRSTUVWXYZ',         // 验证码字符集 (排除易混淆字符)
    'expire_time' => 300,                                   // 验证码过期时间 (秒，默认5分钟)
    'noise_lines' => 3,                                     // 干扰线数量
    'noise_dots' => 50,                                     // 干扰点数量
];

// ============================================================
// API 与模型配置
// ============================================================

return [
    // API 提供商选择:
    //   'native' - Gemini 原生 API (直连 Google)
    //   'openai_compatible' - OpenAI 兼容中转站
    //   'gemini_proxy' - Gemini 原生格式代理 (SSE 流式响应)
    'api_provider' => 'native',

    // Gemini 原生 API 配置
    'api_key' => 'your-gemini-api-key',

    // OpenAI 兼容中转站配置 (当 api_provider 为 'openai_compatible' 时使用)
    'openai_compatible' => [
        'base_url' => 'https://your-openai-compatible-endpoint.com',
        'api_key' => 'your-openai-compatible-key',
        'timeout' => 300,
        'connect_timeout' => 30,
        'enable_thinking' => true,  // 启用思考模型，提取 reasoning_content
    ],

    // Gemini 原生格式代理配置 (当 api_provider 为 'gemini_proxy' 时使用)
    // 支持 SSE 流式响应，适用于国内代理站点，NewAPI 类中转站
    'gemini_proxy' => [
        'base_url' => 'https://your-gemini-proxy-endpoint.com',
        'api_key' => 'your-gemini-proxy-key',
        'timeout' => 300,
        'connect_timeout' => 30,
        'use_streaming' => true,    // 使用 SSE 流式接口
        'thinking_budget' => 26240, // 思考预算 (tokens)
    ],

    // 模型名称
    'model_name' => 'gemini-3-pro-image-preview',

    // 提示词优化配置
    'prompt_optimize_model' => 'gemini-2.5-flash',
    'prompt_instructs' => [
        'basic' => "你是世界级的AI绘画提示词专家，你的任务是将用户输入的简短提示词扩展为更丰富、更详细、更有表现力的AI绘画提示词。请忠实于原意，补充细节、场景、氛围、构图等信息，提升生成效果。只输出最终扩展后的提示词，不输出思考过程或解释。",
        'detail' => "你是世界级的AI绘画提示词专家，你的任务是将用户输入的简短提示词扩展为极其详细、结构化、客观且详尽的AI绘画提示词。请补充主体、场景、细节、光影、风格、构图等信息，提升生成效果。只输出最终扩展后的提示词，不输出思考过程或解释。",
    ],

    // 默认生成配置
    'generation_config' => [
        'responseModalities' => ['TEXT', 'IMAGE'],
        // 注意: responseMimeType 只支持 text/plain, application/json 等文本格式
        // 图片输出格式由 responseModalities 控制，不需要设置 responseMimeType
        'imageConfig' => [
            'aspectRatio' => '1:1', // 默认 1:1
            'imageSize' => '1K',    // 默认 1K
        ]
    ],

    // 思维摘要配置
    'thinking_config' => [
        'include_thoughts' => true,
        'thinking_level' => 'HIGH',
    ],

    // 图片保存路径 (相对于项目根目录)
    'upload_dir' => 'uploads/',
    'output_dir' => 'images/',
    
    // 系统限制配置
    'limits' => [
        'memory_limit' => '768M',      // 内存限制
        'max_execution_time' => 60,   // 最大执行时间 (秒)
    ],

    // 调试模式
    'debug' => true,

    // 语音转文字配置
    'speech_to_text' => [
        // 服务提供商配置 (按优先级排序，当启用回退机制时会依次尝试)
        // 目前支持: 'gemini'
        // 未来计划支持: 'whisper', 'azure', 'google_cloud'
        'providers' => ['gemini'],

        // 是否启用回退机制 (当主提供商失败时尝试下一个)
        'enable_fallback' => false,

        // Gemini 提供商配置
        'model' => 'gemini-2.5-flash',  // 使用快速模型进行转录
        'temperature' => 0.1,           // 低温度确保准确转录
        'max_output_tokens' => 2048,
        'timeout' => 60,                // 请求超时时间 (秒)
        'connect_timeout' => 15,        // 连接超时时间 (秒)

        // 音频文件限制
        'max_audio_size' => 10 * 1024 * 1024,  // 最大音频大小 10MB
        'allowed_mime_types' => [
            'audio/webm',
            'audio/mp4',
            'audio/ogg',
            'audio/wav',
            'audio/mpeg',
            'audio/mp3',
        ],

        // 转录提示词 (可自定义以适应不同场景)
        'prompt' => '请将以下音频内容准确转录为文字。只输出转录的文字内容，不要添加任何解释或格式化。如果音频中没有可识别的语音，请返回空字符串。',
    ],

    // ============================================================
    // 用户系统与支付配置 (引用上方定义的变量)
    // ============================================================
    'database' => $databaseConfig,
    'payment' => $paymentConfig,
    'billing' => $billingConfig,
    'user' => $userConfig,
    'captcha' => $captchaConfig,
];
